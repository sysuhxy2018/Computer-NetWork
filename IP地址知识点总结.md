# IP地址知识点总结



### IPV4 vs IPV6

IPV4：由4组10进制的数表示，每组的范围是0~255，即8bit（1Byte），所以总共需要32bits（4Bytes）表示。

IPV6：由8组16进制的数表示，每组的范围是0000~FFFF，即4 x 4 = 16bits（2Bytes），所以总共需要128bits（16Bytes）表示。

> P.S. 后面的内容都以 IPV4 为标准。



### 分类

A类：000~127，默认子网掩码：255.0.0.0
B类：128~191，默认子网掩码：255.255.0.0
C类：192~223，默认子网掩码：255.255.255.0

即根据IP地址的第一组数就可以判断它的类别，如192是C类，168是B类等等。



### 子网掩码

用于子网的划分。子网掩码是一串连续的1和一串连续的0，如255.255.255.0，255.255.248.0等等。通常我们会在IP地址后面标注子网掩码1的长度，如130.39.37.100/24，这样就能很方便地知道子网掩码是多少了。如果不标的话，表示不划分子网，也可以理解成子网掩码就是IP地址所在类的默认子网掩码。



### 网络地址 & 主机地址 & 子网地址

默认情况下，A类的网络地址是IP地址的前8位，主机地址是后24位；B类的网络地址是前16位，主机地址是后16位；C类的网络地址是前24位，主机地址是后8位。

但实际上有了子网划分后，对于每一类别，可以拿出一部分主机地址位数给网络地址，这时新的网络地址等价于子网地址。即将IP地址和子网掩码做与运算得到网络地址。如IP地址为130.39.37.100，它本身是一个B类地址，在不划分子网的情况下网络地址是130.39.0.0。如果子网掩码是255.255.255.0，则新的网络地址，即子网地址是130.39.37.0。

将IP地址和子网掩码的反码做与运算得到主机地址。还是上面的例子，主机地址是0.0.0.100。在一些较大的公司或者单位，主机数可能比较多，会出现 0.0.2.131 这样超过8位的主机地址。

同一子网（子网地址相同）内的主机之间可以直接通信，但是不同子网的主机就必须借助路由器来通信。



### 子网数 & 主机数

通过子网掩码，可以计算出子网数。还是上面的例子，我们首先根据B类的原网络地址和子网掩码得到子网号范围（即主机地址借给网络地址的那部分位数），子网号范围是0~255，即划分了256个子网。

> P.S. 在CIDR（无类别域间路由）出现前，子网号不能全是0或是全是1，否则会出现地址重叠。所以以前的教材在计算子网数时还要减去2，即254个子网。现在统一按新的标准计算，不用减2。

得到了子网号的位数以及其范围，则根据B类的原主机地址就可以得到剩下部分主机号的位数和范围（及主机地址借出后剩下部分的位数）。子网号是8位，16 - 8 = 8，即最后的8位是主机号。主机号范围是0~255，即主机数为256。但是，这里有两个特殊的主机号要注意。主机号全为0时，表示的是子网网络地址；主机号全为1时，表示的是子网广播地址。所以，真正可供我们使用的主机数应该要减去2，为254。

此外，根据子网数我们也可以计算出子网掩码。如：将168.195.0.0划分成27个子网。

首先，这是一个B类的IP地址，网络地址是前16位，主机地址是后16位。然后我们将27写成二进制形式，即11011。这说明我们至少需要从主机地址分5位给网络地址。接着把B类地址默认的子网掩码255.255.0.0中连续0的部分的前5位设为1，得到255.255.248.0，即为最终的子网掩码。长度为16 + 5 = 21。

类似地，根据主机数我们也可以计算出子网掩码。如：将168.195.0.0划分为若干子网，每个子网内有700台主机。

首先，加上保留的两个主机地址，一共需要702个主机地址。将其用二进制表示为10 1011 1110，则一共需要10位来表示。子网号需要16 - 10 = 6，即6位表示。将B类地址的子网掩码的连续0部分全部置为1，得到255.255.255.255，然后将后10位置0，得到255.255.252.0，即为最终的子网掩码。长度为32 - 10 = 22。



### CIDR（无类别域间路由）

CIDR抛弃了网址的分类，子网的划分等诸多繁琐的概念，直接将IP地址分成网络前缀 + 主机地址两部分。在表示的时候，会在IP地址后面添加网络前缀的长度，也可以直接省略IP地址，如/20等，直接显示前缀长度。网络前缀作用相当于前面的子网掩码，根本目的都是为了标记出网络地址和主机地址。前缀相同的IP地址称为一组CIDR地址块。网络前缀的长度为0~32，长度为n时，说明有2 ^ (32 - n)的IP地址和该地址块的前缀匹配。即长度越长，匹配地址数越少；反之越短，匹配地址数越多。

CIDR的一个好处是可以进行前缀路由聚合，比如16个原来的C类网络（/24），如果它们的前20位都相同，则可以聚合用一个/20的网络来表示。所以，可以有效减少路由表项的数量。

在路由表中的项目由“网络前缀”和“下一跳地址”组成，在查找时可能会得到不止一个匹配结果，应当采用最长前缀匹配来确定应该匹配哪一个。
























# Web页面请求过程

主要结合了前面应用层~数据链路层的一些知识。

* ARP
  * 主机需要根据域名得到对应的IP地址，所以先生成DNS报文，进而是用户数据报，IP数据报。IP数据报目的地址是DNS服务器的IP地址。
  * 然后根据主机上的路由表得到下一跳地址并转发，下一跳地址是网关路路由器。
  * 检查主机上的ARP高速缓存有没有网关路由器IP所对应的MAC地址。没有的话还要再查询。
    * 主机生成一个ARP查询报文封装到IP数据报中，地址是网关路由器的IP。然后进一步封装到广播地址（FF:FF:FF:FF:FF:FF）的以太网帧中，通过交换机发送给所有设备。
    * 网关路由器收到广播帧后，不断拆解得到ARP报文，发现里面的IP地址和自己的匹配，就把MAC地址信息封装成IP数据报，然后是帧，发回给主机。
* DNS
  * 继续，得到网关路由器的MAC地址后主机就能成功发送了。
  * 网关路由器拆解帧得到IP数据报，并根据路由表找出转发地址......通过层层转发，最终到达DNS服务器。中间就是用路由器选择协议，RIP、OSPF和BGP等，默认它们配置好了路由表表项，如果没有也可以自动生成/更新。
  * DNS拆解最终得到报文中的域名信息，然后在数据库中查找得到IP地址。
  * DNS发送回答报文，也是用户数据报，IP数据报。然后反向层层转发给网关路由器，最后返回到主机。
* HTTP
  * 主机先“三次握手”和Web服务器建立连接。
  * 浏览器生成HTTP GET报文和一个TCP套接字(socket)，通过socket向Web服务器发送HTTP请求。
  * Web服务器从TCP套接字读取HTTP GET报文，并生成HTTP响应报文，里面包含了网页内容（HTML）。该报文封装后发送回浏览器。
  * 浏览器得到HTTP响应报文，得到HTML文件，然后渲染显示。如果网页上有图片等其他资源的话，需要额外进行多次HTTP请求才能获得。

